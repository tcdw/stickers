---
import '../styles/global.css';
// ä½¿ç”¨ AI ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
// å¦‚éœ€é‡æ–°ç”Ÿæˆï¼Œè¿è¡Œ: pnpm generate-metadata
import { stickers, platforms } from '../data/stickers-generated.ts';

const siteTitle = 'Yukino Wan Stickers';
const siteDescription = 'å¯çˆ±è´´çº¸ï¼Œä¸€é”®å¤åˆ¶';
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={siteDescription} />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <title>{siteTitle}</title>
</head>
<body class="min-h-screen bg-bg text-primary">
  <div class="max-w-[1200px] mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <header class="text-center mb-12 pb-8 border-b-[3px] border-border">
      <h1 class="text-4xl sm:text-5xl font-bold mb-4 tracking-tight">ğŸ¦Š é›ªç‹è´´çº¸</h1>
      <p class="text-lg opacity-70">ç‚¹å‡»å¤åˆ¶ï¼Œéšå¤„ç²˜è´´</p>
    </header>

    <!-- Platforms -->
    <nav class="flex flex-wrap gap-4 justify-center mb-12" aria-label="å¹³å°é“¾æ¥">
      {platforms.map((platform) => (
        <a
          href={platform.available ? platform.url : undefined}
          class:list={[
            'inline-flex items-center gap-2 px-5 py-3 bg-bg-card border-[3px] border-border font-semibold transition-transform duration-75',
            'hover:not-disabled:-translate-x-0.5 hover:not-disabled:-translate-y-0.5 hover:not-disabled:bg-primary hover:not-disabled:text-primary-text',
            { 'bg-bg border-dashed opacity-60 cursor-not-allowed': !platform.available }
          ]}
          target={platform.available ? '_blank' : undefined}
          rel={platform.available ? 'noopener noreferrer' : undefined}
          onclick={!platform.available ? 'return false;' : undefined}
          aria-disabled={!platform.available}
        >
          <span class="text-xl" aria-hidden="true">{platform.icon}</span>
          <span>{platform.name}</span>
          {!platform.available && (
            <span class="text-xs px-1.5 py-0.5 bg-accent text-accent-text ml-1">æ•¬è¯·æœŸå¾…</span>
          )}
        </a>
      ))}
    </nav>

    <!-- Sticker Grid -->
    <main>
      <section aria-label="è´´çº¸åˆ—è¡¨">
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6" id="sticker-grid">
          {stickers.map((sticker) => (
            <article 
              class="bg-bg-card border-[3px] border-border p-4 md:p-6 flex flex-col items-center transition-transform duration-75 hover:-translate-x-0.5 hover:-translate-y-0.5" 
              data-sticker-id={sticker.id}
            >
              <div class="w-full aspect-square flex items-center justify-center mb-4 bg-bg border-2 border-border">
                <img
                  src={`/stickers/${sticker.file}`}
                  alt={sticker.alt}
                  loading="lazy"
                  decoding="async"
                  class="max-w-[80%] max-h-[80%] object-contain"
                />
              </div>
              <div class="text-2xl mb-2" aria-hidden="true">
                {sticker.emoji.join(' ')}
              </div>
              <p class="text-sm opacity-60 mb-4 text-center">{sticker.alt}</p>
              <button
                class="w-full py-2.5 bg-primary text-primary-text font-semibold text-sm cursor-pointer transition-colors duration-150 hover:bg-accent active:scale-[0.98] disabled:bg-gray-300 disabled:cursor-wait"
                data-image={`/stickers/${sticker.file}`}
                data-filename={sticker.file}
                aria-label={`å¤åˆ¶ ${sticker.alt}`}
              >
                å¤åˆ¶è´´çº¸
              </button>
            </article>
          ))}
          
          {stickers.length === 0 && (
            <div class="col-span-full text-center py-12 border-[3px] border-dashed border-border opacity-60">
              <p>æš‚æ— è´´çº¸ï¼Œæ•¬è¯·æœŸå¾… âœ¨</p>
            </div>
          )}
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="mt-12 pt-8 border-t-[3px] border-border text-center text-sm opacity-60">
      <p>Made with â¤ï¸ for Yukino Wan</p>
    </footer>
  </div>

  <script>
    import { copySticker, showCopyFeedback } from '../scripts/copy-sticker.ts';

    // ä¸ºæ‰€æœ‰å¤åˆ¶æŒ‰é’®ç»‘å®šäº‹ä»¶
    document.querySelectorAll('button[data-image]').forEach((btn) => {
      btn.addEventListener('click', async (e) => {
        const button = e.currentTarget as HTMLButtonElement;
        const imageUrl = button.dataset.image;
        const filename = button.dataset.filename;

        if (!imageUrl || !filename) return;

        // é˜²æ­¢é‡å¤ç‚¹å‡»
        button.disabled = true;
        const originalText = button.textContent;
        button.textContent = 'å¤åˆ¶ä¸­...';

        try {
          const result = await copySticker(imageUrl, filename);
          showCopyFeedback(result.message);
          
          // ä¸´æ—¶æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
          button.textContent = result.method === 'image' ? 'å·²å¤åˆ¶!' : 'å·²å¤„ç†';
          setTimeout(() => {
            button.textContent = originalText;
          }, 2000);
        } catch (error) {
          showCopyFeedback('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
          button.textContent = 'å¤åˆ¶è´´çº¸';
        } finally {
          button.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
