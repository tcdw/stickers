---
import PageWrapper from "../components/PageWrapper.astro";
import StickerPage from "../components/pages/index/StickerPage.tsx";
import { getImage } from "astro:assets";
import type { ImageMetadata } from "astro";
import bannerImage from "../assets/banner.png";

// 使用 AI 生成的数据文件
// 如需重新生成，运行: pnpm generate-metadata
import { stickers } from "../data/stickers-generated.ts";

const stickerImages = import.meta.glob("../assets/stickers/*.{png,jpg,jpeg}", {
  eager: true,
  import: "default",
}) as Record<string, ImageMetadata>;

const bannerOptimized = await getImage({
  src: bannerImage,
  alt: "Site Banner",
  width: 448,
  widths: [448, 896, 1344],
  sizes: "(min-width: 1024px) 448px, 336px",
});

const stickersWithImages = await Promise.all(
  stickers.map(async sticker => {
    const image = stickerImages[`../assets/stickers/${sticker.file}`];

    if (!image) {
      throw new Error(`Missing sticker image: ${sticker.file}`);
    }

    const optimized = await getImage({
      src: image,
      alt: sticker.alt,
      width: 512,
      height: 512,
      widths: [160, 240, 320, 480, 640],
      sizes: "(min-width: 1024px) 240px, (min-width: 768px) 200px, 45vw",
      loading: "lazy",
      decoding: "async",
    });

    return {
      ...sticker,
      image: {
        src: optimized.src,
        srcSet: optimized.srcSet.attribute,
        attributes: optimized.attributes,
      },
      copySrc: image.src,
    };
  }),
);
---

<PageWrapper title="雪乃碗的贴纸" description="点击复制，随处贴贴！可爱的雪乃碗表情贴纸合集。">
  <Fragment slot="head">
    <meta property="og:title" content="雪乃碗的贴纸" />
    <meta property="og:description" content="点击复制，随处贴贴！可爱的雪乃碗表情贴纸合集。" />
    <meta property="og:image" content="https://yukinowan.com/og-image.png" />
    <meta property="og:url" content="https://yukinowan.com/" />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="雪乃碗的贴纸" />
    <meta name="twitter:description" content="点击复制，随处贴贴！可爱的雪乃碗表情贴纸合集。" />
    <meta name="twitter:image" content="https://yukinowan.com/og-image.png" />
  </Fragment>

  <StickerPage
    client:load
    banner={{
      src: bannerOptimized.src,
      srcSet: bannerOptimized.srcSet.attribute,
      attributes: bannerOptimized.attributes,
      alt: "Site Banner",
    }}
    stickers={stickersWithImages}
  />
</PageWrapper>
